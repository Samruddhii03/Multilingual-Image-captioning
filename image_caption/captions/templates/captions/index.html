{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
    <h1>Image Caption Generator with Multilingual Support</h1>
    
    <form id="captionForm" enctype="multipart/form-data" >
        <div class="mb-3">
            <label for="image" class="form-label">Upload an Image:</label>
            <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
        </div>
        <div class="mb-3" style="margin-top: 10px;">
            <label for="language" class="form-label">Select Language:</label>
            <select class="form-select" id="language" name="language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="hi">Hindi</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="ja">Japanese</option>
                <option value="ru">Russian</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Generate Caption</button>
    </form>

    <div id="result" class="mt-4" style="display:none;">
        <h3>Generated Caption:</h3>
        <p id="captionText"></p>
        <img id="uploadedImage" src="" class="img-fluid mt-3" alt="Uploaded Image" style="max-width: 400px;">
    </div>
</div>
<script>
    document.getElementById('captionForm').onsubmit = function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch("{% url 'generate_caption_view' %}", {
        method: "POST",
        body: formData,
        headers: {
            'X-CSRFToken': '{{ csrf_token }}'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            document.getElementById('captionText').innerText = data.caption;
            document.getElementById('uploadedImage').src = data.image_url;
            document.getElementById('result').style.display = 'block';
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
};
</script>

{% endblock %}
